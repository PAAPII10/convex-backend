# --- Core Configuration ---
NODE_ENV=production
CONVEX_DEPLOYMENT=production
CONVEX_INSTANCE_NAME=production-instance
CONVEX_INSTANCE_SECRET=replace-with-secure-random-string

# --- Public URLs ---
CONVEX_SITE_URL=https://api.yourdomain.com
CONVEX_CLOUD_ORIGIN=https://api.yourdomain.com
CONVEX_SITE_ORIGIN=https://api.yourdomain.com

# --- Database (Supabase PostgreSQL) ---
# IMPORTANT: Use POSTGRES_URL (not DATABASE_URL) - DATABASE_URL is deprecated
# Do NOT include /DATABASE in the URL
# Convex will automatically use a database based on CONVEX_INSTANCE_NAME
# 
# For DIRECT connection (port 5432):
# POSTGRES_URL=postgresql://postgres:[PASSWORD]@db.xxxxx.supabase.co:5432
# 
# For POOLER connection (port 6543) - RECOMMENDED:
# POSTGRES_URL=postgresql://postgres.xxxxx:[PASSWORD]@aws-1-ap-south-1.pooler.supabase.com:6543
# 
# Get from: Supabase Dashboard → Settings → Database → Connection string
# Remove /postgres from the end
# 
# For SSL/TLS issues with Supabase, you may need to add ?sslmode=require
# POSTGRES_URL=postgresql://postgres.xxxxx:[PASSWORD]@aws-1-ap-south-1.pooler.supabase.com:6543?sslmode=require
POSTGRES_URL=postgresql://USER:PASSWORD@HOST:PORT

# --- Action Compute ---
# ACTION_WORKER_COUNT controls how many Convex actions can run concurrently
# 
# What are Actions?
# - Actions are server-side functions that can call external APIs, make HTTP requests,
#   interact with third-party services, and perform non-deterministic operations
# - Examples: Sending emails, calling OpenAI API, webhooks, file processing
# - Actions run on port 3211 (HTTP actions endpoint)
#
# What does ACTION_WORKER_COUNT do?
# - Sets the number of worker processes/threads that handle action executions
# - Higher = more concurrent actions, but uses more CPU and memory
# - Lower = fewer concurrent actions, but uses less resources
#
# Recommended values based on instance size:
# For t2.micro (1 vCPU, 1GB RAM), use 1-2 workers (swap space REQUIRED)
# For t3.micro (2 vCPU, 1GB RAM), reduce to 2-4 workers to prevent OOM
# For t3.small (2GB RAM), use 4-6 workers
# For t3.medium+ (4GB+ RAM), 8 workers is recommended
ACTION_WORKER_COUNT=8

# --- File Storage (Supabase S3-compatible) ---
AWS_ACCESS_KEY_ID=SUPABASE_S3_ACCESS_KEY
AWS_SECRET_ACCESS_KEY=SUPABASE_S3_SECRET_KEY
AWS_REGION=us-east-1
AWS_S3_ENDPOINT=https://<project-id>.supabase.co/storage/v1/s3

# Convex requires 5 S3 buckets for different storage types
# You can use the same bucket name for all, or create separate buckets
# Create these buckets in Supabase Storage dashboard
S3_STORAGE_FILES_BUCKET=convex-files
S3_STORAGE_MODULES_BUCKET=convex-modules
S3_STORAGE_EXPORTS_BUCKET=convex-exports
S3_STORAGE_SNAPSHOT_IMPORTS_BUCKET=convex-snapshots
S3_STORAGE_SEARCH_BUCKET=convex-search

# OR use the same bucket for all (simpler):
# S3_STORAGE_FILES_BUCKET=convex-storage
# S3_STORAGE_MODULES_BUCKET=convex-storage
# S3_STORAGE_EXPORTS_BUCKET=convex-storage
# S3_STORAGE_SNAPSHOT_IMPORTS_BUCKET=convex-storage
# S3_STORAGE_SEARCH_BUCKET=convex-storage

# MAX_FILE_SIZE_BYTES: Maximum file size that can be uploaded/stored (in bytes)
# 
# What does this control?
# - Maximum size for files uploaded to Convex file storage (stored in Supabase S3)
# - Applies to files uploaded via Convex storage API
# - Files larger than this limit will be rejected
#
# Default: 104857600 bytes = 100 MB
# Common values:
#   10485760   = 10 MB
#   52428800   = 50 MB
#   104857600  = 100 MB (default)
#   524288000  = 500 MB
#   1073741824 = 1 GB
#
# Note: This is separate from HTTP action upload limits (20 MB) and document size limits (1 MB)
MAX_FILE_SIZE_BYTES=104857600

# --- Security ---
JWT_SIGNING_KEY=replace-with-secure-random-string

# --- Vector Search (Optional) ---
# VECTOR_EMBEDDING_PROVIDER=openai
# OPENAI_API_KEY=your-openai-api-key

# --- Admin Key (Generated after first run) ---
# CONVEX_ADMIN_KEY=instance|your-admin-key-here
